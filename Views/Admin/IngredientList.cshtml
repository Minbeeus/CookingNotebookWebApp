@model IEnumerable<CookingNotebookWebApp.Models.Ingredient>

@{
    Layout = "~/Pages/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Danh sách nguyên liệu";
    ViewData["ActiveMenu"] = "IngredientList";
}

<link rel="stylesheet" href="~/css/Admin/ingredientlist.css" />
<link rel="stylesheet" href="~/css/Admin/ingredientdetails.css" />

<div class="ingredient-list">
    <h2 class="page-title">Quản lý nguyên liệu</h2>

    <div class="actions-bar">
    <div class="search-section" style="display: flex; gap: 20px; align-items: center;">
    <div style="display: flex; gap: 8px; align-items: center;">
    <input type="text" id="searchInput" placeholder="Tìm kiếm nguyên liệu..." class="form-control" style="width: 300px;" />
    </div>
    <div style="display: flex; gap: 15px; align-items: center;">
    <label for="typeFilter" style="color: #E0E1DD; font-weight: 500; white-space: nowrap;">Phân loại:</label>
    <select id="typeFilter" class="form-control" style="width: 150px;">
    <option value="">Tất cả</option>
    @foreach (var type in ViewBag.Types as List<string>)
    {
    <option value="@type" @(ViewBag.TypeFilter == type ? "selected" : "")>@type</option>
    }
    </select>
    <button type="button" id="clearAllBtn" class="clear-search-btn" title="Xoá tất cả bộ lọc" style="font-size: 14px; color: #E0E1DD; padding: 4px 12px; border: 1px solid #3A475C; background: #2A3441; border-radius: 4px; width: 90px;">Xoá lọc</button>
    </div>
    </div>
        <div class="action-section">
        <button type="button" onclick="createIngredient()" class="btn" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px; font-weight: 600;"><i class="fa-solid fa-plus" style="margin-right: 8px;"></i>Thêm nguyên liệu</button>
        </div>
    </div>

    <div class="table-responsive">
        <table class="ingredient-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tên tiếng Việt</th>
                    <th>Tên tiếng Anh</th>
                    <th>Loại</th>
                    <th>Mô tả</th>
                    <th>Hình ảnh</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ingredient in Model)
                {
                    <tr>
                    <td>@ingredient.IngredientId</td>
                    <td>@ingredient.Name</td>
                    <td>@ingredient.EnName</td>
                    <td>@ingredient.Type</td>
                        <td>@(ingredient.Description?.Length > 50 ? ingredient.Description.Substring(0, 50) + "..." : ingredient.Description)</td>
                        <td>
                            @if (!string.IsNullOrEmpty(ingredient.ImagePath))
                            {
                                <img src="@ingredient.ImagePath" alt="@ingredient.Name" class="ingredient-image" />
                            }
                            else
                            {
                                <span>Không có</span>
                            }
                        </td>
                        <td class="action-buttons">
                        <button type="button" class="action-btn view-btn" onclick="viewIngredientDetails(@ingredient.IngredientId)">Xem</button>
                        <button type="button" class="action-btn edit-btn" onclick="editIngredient(@ingredient.IngredientId)">Sửa</button>
                        <button type="button" class="action-btn delete-btn" onclick="confirmDeleteIngredient(@ingredient.IngredientId, '@ingredient.Name')">Xóa</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    @if (Convert.ToInt32(ViewBag.TotalPages) > 1)
    {
    <div class="pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
    @if (Convert.ToInt32(ViewBag.CurrentPage) > 1)
    {
    <a href="@Url.Action("IngredientList", "Admin", new { page = Convert.ToInt32(ViewBag.CurrentPage) - 1, searchTerm = ViewBag.SearchTerm, typeFilter = ViewBag.TypeFilter })" class="btn" style="background: #A9A9A9; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">&laquo; Trước</a>
    }

    <span style="color: #E0E1DD; font-weight: 600;">Trang @Convert.ToInt32(ViewBag.CurrentPage) / @Convert.ToInt32(ViewBag.TotalPages)</span>

    @if (Convert.ToInt32(ViewBag.CurrentPage) < Convert.ToInt32(ViewBag.TotalPages))
    {
    <a href="@Url.Action("IngredientList", "Admin", new { page = Convert.ToInt32(ViewBag.CurrentPage) + 1, searchTerm = ViewBag.SearchTerm, typeFilter = ViewBag.TypeFilter })" class="btn" style="background: #A9A9A9; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Sau &raquo;</a>
    }
    </div>
    }

    

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteIngredientModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content" style="background: #1B263B; border: 2px solid #3A475C; border-radius: 12px; color: #E0E1DD;">
    <div class="modal-header" style="background: #2A3441; border-bottom: 1px solid #3A475C; border-radius: 12px 12px 0 0;">
    <h5 class="modal-title" id="deleteModalLabel" style="color: #FFFFFF; font-weight: 600;">Xác nhận xóa nguyên liệu</h5>
    </div>
    <div class="modal-body" style="background: #1B263B; padding: 25px; text-align: center;">
    <p style="font-size: 16px; margin-bottom: 15px;">Bạn có chắc chắn muốn xóa nguyên liệu "<span id="deleteIngredientName" style="color: #68C69F; font-weight: 600;"></span>"?</p>
        <p style="color: #FF6B6B; font-weight: 600; margin-bottom: 0;">Hành động này không thể hoàn tác!</p>
    </div>
    <div class="modal-footer" style="background: #2A3441; border-top: 1px solid #3A475C; border-radius: 0 0 12px 12px; justify-content: center; gap: 15px;">
    <button type="button" class="btn" onclick="$('#deleteIngredientModal').modal('hide');" style="background: #A9A9A9; color: white; padding: 10px 20px; border-radius: 6px; border: none; font-weight: 600; font-size: 14px;">Hủy</button>
    <button type="button" class="btn" onclick="confirmDelete()" style="background: #D9534F; color: white; padding: 10px 20px; border-radius: 6px; border: none; font-weight: 600; font-size: 14px;">Xóa</button>
    </div>
    </div>
    </div>
    </div>

    <!-- Ingredient Details Modal -->
    <div class="modal fade" id="ingredientDetailsModal" tabindex="-1" role="dialog" aria-labelledby="ingredientDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content" style="background: #1B263B; border: 2px solid #3A475C; border-radius: 12px;">
                <div class="modal-header" style="background: #2A3441; border-bottom: 1px solid #3A475C; border-radius: 12px 12px 0 0;">
                    <h5 class="modal-title" id="ingredientDetailsModalLabel" style="color: #FFFFFF; font-weight: 600;">Chi tiết nguyên liệu</h5>
                </div>
                <div class="modal-body" id="ingredientDetailsContent" style="background: #1B263B; padding: 25px;">
                    <!-- Content will be loaded here -->
                </div>
                <div class="modal-footer" style="background: #2A3441; border-top: 1px solid #3A475C; border-radius: 0 0 12px 12px; justify-content: space-between;">
                    <a href="#" id="editIngredientBtn" class="btn btn-warning" style="background: #ffc107; color: #212529; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 14px; border: none;">
                        <i class="fa-solid fa-pen-to-square" style="margin-right: 5px;"></i>Sửa
                    </a>
                    <button type="button" class="btn btn-secondary" onclick="$('#ingredientDetailsModal').modal('hide');" style="background: #A9A9A9; color: white; padding: 10px 20px; border-radius: 6px; border: none; font-weight: 600; font-size: 14px;">Đóng</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script src="~/js/Admin/ingredientlist.js" asp-append-version="true"></script>
}

