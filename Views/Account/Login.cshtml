@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
    ViewData["Title"] = "ÄÄƒng nháº­p - Cooking Notebook";
}

<link rel="stylesheet" href="~/css/Account/login.css" />
<script src="https://accounts.google.com/gsi/client" async defer></script>

<div class="login-container">
    <div class="login-card">
        <div class="login-header">
            <h1>ğŸ³ Cooking Notebook</h1>
            <p>ChÃ o má»«ng trá»Ÿ láº¡i! Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ tiáº¿p tá»¥c.</p>
        </div>

        @Html.ValidationSummary(false, "", new { @class = "alert alert-danger", @style = "margin-bottom: 20px;" })

        <form id="loginForm" method="post" asp-action="Login" asp-controller="Account">
            @Html.AntiForgeryToken()

            <div class="form-group">
                <label for="Email">Email</label>
                <input type="email" id="Email" name="Email" required placeholder="Nháº­p email cá»§a báº¡n" />
                <small class="error-message" id="emailError"></small>
            </div>

            <div class="form-group">
                <label for="Password">Máº­t kháº©u</label>
                <input type="password" id="Password" name="Password" required placeholder="Nháº­p máº­t kháº©u" />
                <small class="error-message" id="passwordError"></small>
            </div>

            @* <div class="form-check mb-3">
            <input asp-for="RememberMe" class="form-check-input" />
            <label asp-for="RememberMe" class="form-check-label"></label>
            </div> *@

            <button type="submit" class="btn-login">ÄÄƒng nháº­p</button>

            <div class="divider">hoáº·c</div>

            <div id="g_id_onload"
                 data-client_id="520683967311-8b4fmbfjprk3e4uinojds4tmr7mhj16c.apps.googleusercontent.com"
                 data-callback="onGoogleSignIn"
                 data-context="signin">
            </div>

            <div class="g_id_signin"
                 data-type="standard"
                 data-theme="outline"
                 data-text="sign_in_with"
                 data-shape="rectangular"
                 data-logo_alignment="left">
            </div>

            <div class="login-links">
            <a href="/Account/Register">ÄÄƒng kÃ½ ngay</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
<script src="~/js/Account/login.js"></script>
    <script>
        function onGoogleSignIn(googleResponse) {
            const id_token = googleResponse.credential;

            // Gá»­i token Ä‘áº¿n server
            fetch('/Account/GoogleLogin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'token=' + encodeURIComponent(id_token)
            })
            .then(response => {
                if (response.ok) {
                    // Redirect sáº½ Ä‘Æ°á»£c handle bá»Ÿi server
                    window.location.reload();
                } else {
                    return response.text().then(error => {
                        console.log('ÄÄƒng nháº­p tháº¥t báº¡i:', error);
                        //alert('ÄÄƒng nháº­p tháº¥t báº¡i! Xem console Ä‘á»ƒ biáº¿t chi tiáº¿t.');
                    });
                }
            })
            .catch(error => {
                console.error('Lá»—i:', error);
                alert('ÄÄƒng nháº­p tháº¥t báº¡i!');
            });
        }
    </script>
}