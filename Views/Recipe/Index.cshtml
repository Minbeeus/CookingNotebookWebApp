@model IEnumerable<CookingNotebookWebApp.Models.Recipe>

@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
    ViewData["Title"] = "Danh s√°ch c√¥ng th·ª©c";
}

@section Styles {
<link rel="stylesheet" href="~/css/Recipe/index.css" />
    <link rel="stylesheet" href="~/css/Recipe/details.css" />
    <style>
        /* Responsive cho thi·∫øt b·ªã di ƒë·ªông */
        @@media (max-width: 768px) {
            .recipe-container {
                flex-direction: column;
            }

            .recipe-sidebar {
                width: 100%;
                border-right: none;
                padding-right: 0;
                margin-bottom: 20px;
            }

            .recipe-content {
                width: 100%;
            }

            .recipe-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .search-bar {
                width: 100%;
            }

            /* Chuy·ªÉn grid view th√†nh 1 c·ªôt */
            .recipe-list.grid-view {
                grid-template-columns: 1fr;
            }

            /* T·ªëi ∆∞u modal chi ti·∫øt c√¥ng th·ª©c */
            .recipe-details .recipe-header {
                flex-direction: column;
            }

            .recipe-details .recipe-image {
                width: 100%;
                max-width: none;
                margin-right: 0;
                margin-bottom: 15px;
            }

            .recipe-details .recipe-info {
                width: 100%;
            }

            .recipe-meta {
                justify-content: space-around;
                flex-wrap: wrap;
            }

            .steps-carousel .step-item {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .step-item .step-image {
                margin-right: 0;
                margin-bottom: 15px;
                width: 100%;
                max-width: 250px;
            }

            .steps-carousel {
                align-items: stretch;
            }

            .carousel-btn {
                position: static;
                transform: none;
                margin: 0 10px;
            }

            /* T·ªëi ∆∞u modal reviews v√† rate */
            #reviewsModal .modal-content,
            #rateModal .modal-content {
                width: 95%;
                padding: 15px;
            }

            .pagination-controls {
                flex-direction: column;
                gap: 10px;
            }

            .pagination-controls .pagination-btn {
                width: 100%;
            }
        }
    </style>
}

<div class="recipe-page">
    <!-- Header -->
    <div class="recipe-header">
        <h2>üç≥ Danh s√°ch c√¥ng th·ª©c</h2>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="T√¨m c√¥ng th·ª©c..." />
            <button id="searchBtn">üîç</button>
        </div>
    </div>

    <div class="recipe-container">
        <!-- Sidebar b·ªô l·ªçc -->
        <aside class="recipe-sidebar">
        <div class="filter-header">
                <button id="clearFilters" class="clear-filters-btn">‚ùå Xo√° l·ªçc</button>
            </div>
            <h3>Lo·∫°i m√≥n</h3>
            <ul id="typeOfDishList">
                <li class="@(string.IsNullOrEmpty(ViewBag.TypeOfDishFilter as string) ? "active" : "")" data-value="">T·∫•t c·∫£</li>
                @foreach (var type in ViewBag.TypeOfDishes as List<string>)
                {
                    <li class="@(ViewBag.TypeOfDishFilter == type ? "active" : "")" data-value="@type">@type</li>
                }
            </ul>

            <h3>Ph∆∞∆°ng ph√°p n·∫•u</h3>
            <ul id="cookingMethodList">
                <li class="@(string.IsNullOrEmpty(ViewBag.CookingMethodFilter as string) ? "active" : "")" data-value="">T·∫•t c·∫£</li>
                @foreach (var method in ViewBag.CookingMethods as List<string>)
                {
                    <li class="@(ViewBag.CookingMethodFilter == method ? "active" : "")" data-value="@method">@method</li>
                }
            </ul>

            <h3>Th·ªùi gian</h3>
            <ul id="timeList">
                <li class="@(string.IsNullOrEmpty(ViewBag.TimeFilter as string) || ViewBag.TimeFilter == "all" ? "active" : "")" data-value="all">T·∫•t c·∫£</li>
                <li class="@(ViewBag.TimeFilter == "15" ? "active" : "")" data-value="15">D∆∞·ªõi 15 ph√∫t</li>
                <li class="@(ViewBag.TimeFilter == "30" ? "active" : "")" data-value="30">15-30 ph√∫t</li>
                <li class="@(ViewBag.TimeFilter == "60" ? "active" : "")" data-value="60">30-60 ph√∫t</li>
                <li class="@(ViewBag.TimeFilter == "120" ? "active" : "")" data-value="120">Tr√™n 60 ph√∫t</li>
            </ul>
        </aside>

        <!-- Danh s√°ch c√¥ng th·ª©c -->
        <section class="recipe-content">
            <div class="view-toggle">
                <button id="gridView" class="active">üî≤ D·∫°ng l∆∞·ªõi</button>
                <button id="listView">üìã D·∫°ng danh s√°ch</button>
            </div>

            <div class="recipe-list grid-view" id="recipeList">
                @foreach (var recipe in Model)
                {
                <div class="recipe-link" data-recipe-id="@recipe.RecipeId">
                <div class="recipe-card"
                data-typeofdish="@recipe.Type_of_dish"
                data-cookingmethod="@recipe.Cooking_method"
                data-time="@(recipe.PrepTime + recipe.CookTime)"
                data-title="@recipe.Title"
                data-description="@recipe.Description"
                data-image="@recipe.ImageUrl"
                data-preptime="@recipe.PrepTime"
                data-cooktime="@recipe.CookTime"
                data-servings="@recipe.Servings"
                data-author="@recipe.User?.FullName"
                     data-totaltime="@(recipe.PrepTime + recipe.CookTime)">
                    <img src="@recipe.ImageUrl" alt="@recipe.Title" />
                <div class="info">
                    <h4>@recipe.Title</h4>
                <div class="meta">
                    <span>‚è±Ô∏è @(recipe.PrepTime + recipe.CookTime) ph√∫t</span>
                        <span>üë• @recipe.Servings ng∆∞·ªùi</span>
                    </div>
                        <p>@recipe.Description</p>
                        </div>
                        </div>
                        </div>
                        }
            </div>
        </section>
    </div>

    <!-- Modal chi ti·∫øt c√¥ng th·ª©c -->
    <div class="recipe-modal modal" id="recipeModal">
    <div class="recipe-details modal-recipe-details" style="width: 90vw; max-width: 1100px;">
    <span class="close-modal">&times;</span>

    <!-- Header with image and info -->
    <div class="recipe-header">
        <div class="recipe-image">
        <img id="modalImage" src="" alt="" />
    </div>
    <div class="recipe-info">
            <div class="recipe-meta">
                <div class="meta-item">
                        <i class="fas fa-clock"></i>
                            <span id="modalPrepTime"></span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-fire"></i>
                            <span id="modalCookTime"></span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-users"></i>
                            <span id="modalServings"></span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-star"></i>
                            <span id="modalRating"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipe title -->
            <h1 id="modalTitle" class="recipe-title"></h1>

            <!-- Description -->
            <div class="recipe-description">
                <p id="modalDescription"></p>
            </div>

            <!-- Ingredients -->
            <div class="recipe-ingredients" id="modalIngredients" style="display: none;">
                <h2 id="modalIngredientsTitle">Nguy√™n li·ªáu</h2>
                <ul class="ingredients-list" id="modalIngredientsList"></ul>
            </div>

            <!-- Steps -->
            <div class="recipe-steps" id="modalSteps" style="display: none;">
                <h2>C√°c b∆∞·ªõc th·ª±c hi·ªán</h2>
                <div class="steps-carousel" id="modalStepsCarousel" style="display: none;">
                    <button class="carousel-btn prev-btn" id="modalPrevStep">
                        <i class="fas fa-chevron-left"></i>
                    </button>

                    <div class="steps-content" id="modalStepsContent"></div>

                    <button class="carousel-btn next-btn" id="modalNextStep">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <div class="steps-indicators" id="modalStepsIndicators" style="display: none;"></div>

                <p id="modalNoSteps" style="display: none;">Kh√¥ng c√≥ b∆∞·ªõc th·ª±c hi·ªán n√†o ƒë∆∞·ª£c cung c·∫•p.</p>
            </div>

            <!-- Notes -->
            <div class="recipe-notes" id="modalNotes" style="display: none;">
                <h2>L∆∞u √Ω</h2>
                <p id="modalNotesContent"></p>
            </div>

            <!-- Action buttons -->
            <div class="action-buttons modal-actions">
            @if (User.Identity.IsAuthenticated)
                {
                    <button class="action-btn favorite-btn" id="modalFavoriteBtn" data-recipe-id="0">
                        <i class="fas fa-heart"></i>
                    </button>
                }

                <button class="action-btn review-btn" id="modalReviewBtn" data-recipe-id="0">
                    <i class="fas fa-comments"></i>
                </button>

                @if (User.Identity.IsAuthenticated)
                {
                    <button class="action-btn rate-btn" id="modalRateBtn" data-recipe-id="0">
                        <i class="fas fa-star"></i>
                    </button>
                }
            </div>
        </div>
    </div>

    <!-- Reviews Modal -->
    <div class="modal" id="reviewsModal">
        <div class="modal-content">
            <span class="close-modal" id="closeReviewsModal">&times;</span>
            <h2>ƒê√°nh gi√° & B√¨nh lu·∫≠n</h2>

            <div class="reviews-list" id="reviewsList">
                <!-- Reviews will be loaded here -->
            </div>

            <div class="pagination-controls" id="paginationControls">
                <button class="pagination-btn" id="prevPage" disabled>
                    <i class="fas fa-chevron-left"></i> Tr∆∞·ªõc
                </button>
                <span id="pageInfo">Trang 1</span>
                <button class="pagination-btn" id="nextPage" disabled>
                    Sau <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Rate Modal -->
    @if (User.Identity.IsAuthenticated)
    {
        <div class="modal" id="rateModal">
            <div class="modal-content">
                <span class="close-modal" id="closeRateModal">&times;</span>
                <h2>ƒê√°nh gi√° c√¥ng th·ª©c</h2>

                <form id="rateForm">
                    <div class="rating-stars">
                        <span class="star" data-rating="1">‚òÖ</span>
                        <span class="star" data-rating="2">‚òÖ</span>
                        <span class="star" data-rating="3">‚òÖ</span>
                        <span class="star" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>

                    <textarea id="reviewComment" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." rows="4"></textarea>

                    <div class="modal-actions">
                        <button type="button" class="cancel-btn" id="cancelRate">H·ªßy</button>
                        <button type="submit" class="submit-btn" id="submitRateBtn">G·ª≠i ƒë√°nh gi√°</button>
                        <button type="button" class="delete-btn" id="deleteRateBtn" style="display: none;">X√≥a ƒë√°nh gi√°</button>
                    </div>
                </form>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script src="~/js/Recipe/index.js"></script>
}
